---
import Layout from "../layouts/Layout.astro";
import type { PaginateFunction } from "astro";
import { getCollection } from "astro:content";
import type { CollectionName } from "@/types/Collection";
import { isCollectionEmpty } from "@/content.config";
import type { Post } from "@/types/Card";
import Card from "../components/Card.astro";
export const title = "Home";

export const collectionUsed: CollectionName = "blog";
const isEmpty = await isCollectionEmpty(collectionUsed);
if (isEmpty) {
  console.warn(`${collectionUsed} collection is empty`);
  return Astro.rewrite("/404");
}

const latestPost = (await getCollection("blog"))
  .map(
    (post) =>
      ({
        url: `/blog/${post.id}`,
        title: post.data.title,
        description: post.data.description,
        created: post.data.created,
      }) as Post,
  )
  .sort(
    (postA, postB) => postB.created!.getTime() - postA.created!.getTime(),
  )[0];
---

<Layout title="Hello there" description="Hello there">
  <section>
    <h1>Hello there</h1>
    <p>
      Voluptate rerum fuga unde. Deserunt ea quibusdam consequatur. Impedit
      repellat ab est sequi veritatis et non perspiciatis.
    </p>
    <p>
      Iusto iste sit in unde voluptate debitis. Sit officia quis eveniet est
      nobis. Repudiandae vitae quos est autem et quaerat.
    </p>
    <p>
      Vel reiciendis velit ipsa ea. Quod ullam beatae hic quo. Et ut repellendus
      consectetur deleniti reprehenderit quaerat architecto sint.
    </p>
    <p>
      Eos nam itaque accusantium nulla minima et facere dignissimos. Dolore
      repellendus aut rem. Aut dignissimos distinctio explicabo. Placeat laborum
      placeat id exercitationem deserunt non. Impedit illum consequuntur quos
      rerum aut veritatis dolor dolores. Molestias laudantium at perspiciatis
      qui deleniti doloribus facere neque.
    </p>
    <p>
      Quaerat voluptates soluta quam sit nihil sed quis aut. Et voluptates est
      est minima ut atque et. Qui fuga eos aut. Magni ratione in est corrupti
      totam.
    </p>
  </section>
  <section>
    <h2>Latest post</h2>
    <Card
      url={latestPost.url}
      title={latestPost.title}
      description={latestPost.description}
      date={latestPost.created}
      titleLevel={3}
    />
    <span>
      <a href="/blog/"> More posts here...</a>
    </span>
  </section>
</Layout>
